#!/bin/bash

set -eux

CONFIG_FILE="${SNAP_DATA}/etc/pbm/pbm_config.yaml"

# set the config file for pbm
PBM_MONGODB_URI=$(snapctl get pbm-uri)
if [ -n "${PBM_MONGODB_URI}" ]; then
    export PBM_MONGODB_URI

    # pbm requires that a config file was set up in order to facilitate further congurations. Note 
    # snaps require special permissions to read files outside of the typical snap directories so
    # it is important that we set this to a file the snap is able to access.
    # Further, this command requires that the uri has already been set so we must do it after the
    # user sets the uri
    "$SNAP/usr/bin/pbm" config --file "${CONFIG_FILE}"
fi

